# Kế hoạch Xử lý Logic Lưu Ghi chú Chủ nhà

Để giải quyết vấn đề mất mát thông tin ghi chú và xử lý logic cập nhật khi chủ nhà đã tồn tại, tôi đề xuất kế hoạch như sau:

## 1. Cơ sở dữ liệu

* Sử dụng cột `about` trong bảng `crm_hosts` để lưu ghi chú. Cột này đã tồn tại trong schema, không cần tạo migration mới.

## 2. Backend Logic (TelegramWebAppController.php)

Sửa đổi hàm `submitForm` để xử lý logic "Append" (Nối thêm) ghi chú:

* **Logic cũ:** `about` (ghi chú) bị bỏ qua hoàn toàn.

* **Logic mới:**

  1. Lấy giá trị `note` từ form gửi lên.
  2. Nếu `note` có dữ liệu:

     * Nếu là Host mới: Gán trực tiếp `$host->about = $note`.

     * Nếu là Host cũ (đã tồn tại):

       * Kiểm tra xem nội dung `note` mới này đã có trong `about` cũ chưa (để tránh trùng lặp nội dung).

       * Nếu chưa có: Nối thêm vào `about` cũ theo định dạng: `[Nội dung cũ] \n [Ngày tháng]: [Nội dung mới]`.

       * Ví dụ: `Gọi lại sau 5h \n [2023-10-27]: Khách bận họp`. \
         Chú ý là không để người nhập thông tin thấy được thông tin ghi chú

## 3. Quy trình Kiểm thử (Testing)

Cập nhật file `tests/Feature/HostManagementTest.php` để thêm các test case sau:

* **Test Create New:** Tạo host mới kèm ghi chú -> Kiểm tra DB xem cột `about` có dữ liệu không.

* **Test Update Existing:** Submit lại host cũ với ghi chú mới -> Kiểm tra DB xem cột `about` có được nối thêm nội dung không.

## 4. Các bước thực hiện

1. **Backend:** Cập nhật `TelegramWebAppController.php` để xử lý logic nối chuỗi cho trường `about`.
2. **Test:** Viết thêm test case trong `HostManagementTest.php`.
3. **Verify:** Chạy test suite để đảm bảo logic hoạt động đúng.

